<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalmeron Chat</title>
<style>
:root {
--primary-color: #2A0B5C;
--secondary-color: #0A043C;
--accent-color: rgba(42, 11, 92, 0.7);
--text-color: aqua;
--border-color: rgba(0, 255, 255, 0.3);
--shadow-color: rgba(0, 255, 255, 0.25);
}
body.mode-science {
--primary-color: #0D47A1;
--secondary-color: #1A237E;
--accent-color: rgba(13, 71, 161, 0.7);
--text-color: #BBDEFB;
--border-color: rgba(187, 222, 251, 0.3);
--shadow-color: rgba(187, 222, 251, 0.25);
}
body {
font-family: "Cairo", sans-serif;
background: radial-gradient(circle at top, var(--primary-color), var(--secondary-color));
color: var(--text-color);
margin: 0;
height: 100vh;
overflow: hidden;
display: flex;
flex-direction: column;
}
header {
position: fixed;
top: 10px;
left: 50%;
transform: translateX(-50%);
background: rgba(0, 0, 0, 0.6);
border: 1px solid var(--border-color);
border-radius: 25px;
padding: 12px 20px;
font-size: 22px;
color: var(--text-color);
text-align: center;
z-index: 1000;
backdrop-filter: blur(5px);
max-width: 95%;
cursor: pointer;
display: flex;
align-items: center;
gap: 12px;
font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
font-weight: 700;
letter-spacing: 0.5px;
}
#newChatBtn {
background: var(--accent-color);
border: 1px solid var(--border-color);
border-radius: 50%;
width: 36px;
height: 36px;
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
transition: all .3s;
z-index: 1001;
font-size: 24px;
font-weight: bold;
/* Ø¬Ø¹Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ´Ø¨Ù‡ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
background: rgba(0, 0, 0, 0.45);
border: 1px solid var(--border-color);
}
#newChatBtn:hover {
background: rgba(0, 255, 255, 0.4);
transform: scale(1.1);
}
#chat {
flex: 1;
overflow-y: auto;
padding: 80px 20px 150px;
display: flex;
flex-direction: column;
}
/* Scrollbar styling for chat container */
#chat::-webkit-scrollbar {
width: 8px;
}
#chat::-webkit-scrollbar-track {
background: transparent;
border-radius: 10px;
}
#chat::-webkit-scrollbar-thumb {
background: var(--text-color);
border-radius: 10px;
border: 2px solid transparent;
background-clip: padding-box;
}
#chat::-webkit-scrollbar-thumb:hover {
background: rgba(0, 255, 255, 0.7);
}
/* === BANNER Ø§Ù„ØªØ±Ø­ÙŠØ¨ === */
#welcomeBanner {
position: fixed;
top: 0;
left: 50%;
transform: translateX(-50%) translateY(-100%);
background: rgba(0, 0, 0, 0.7);
border: 1px solid var(--border-color);
border-radius: 20px;
padding: 12px 24px;
color: var(--text-color);
font-size: 18px;
font-weight: bold;
z-index: 2000;
opacity: 0;
transition: all 0.4s ease;
text-align: center;
direction: rtl;
}
#welcomeBanner.show {
transform: translateX(-50%) translateY(80px);
opacity: 1;
}
#welcomeBanner.hide {
transform: translateX(-50%) translateY(-100%);
opacity: 0;
}
.msg {
margin: 10px;
padding: 14px 18px;
border-radius: 20px;
max-width: 75%;
line-height: 1.6;
font-size: 17px;
font-weight: 600;
word-wrap: break-word;
animation: fadeIn .4s;
box-shadow: none;
}
.user {
background: rgba(0, 255, 255, 0.15);
color: aqua;
align-self: flex-end;
border: 1px solid rgba(0, 255, 255, 0.3);
margin-left: auto;
text-align: right;
direction: rtl;
}
/* === Ø§Ù„Ø±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ© â€” Ù„ÙƒÙ†Ù‡ ØªØ­Øª Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆÙ…Ø­Ø§Ø°ÙŠ Ù„Ù„ÙŠÙ…ÙŠÙ† === */
.bot-response {
margin: 10px;
padding: 0;
background: none !important;
border: none !important;
box-shadow: none !important;
color: var(--text-color);
font-size: 17px;
font-weight: 600;
line-height: 1.6;
text-align: right;
direction: rtl;
max-width: 75%;
word-wrap: break-word;
align-self: flex-end; /* â† Ù…Ù‡Ù…: ÙŠØ¬Ø¹Ù„Ù‡ Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø«Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
animation: fadeIn .4s;
}
@keyframes fadeIn {
from {
opacity: 0;
transform: translateY(10px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
/* === ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© === */
.thinking-dots {
display: inline-block;
width: 24px;
text-align: left;
}
.thinking-dots::after {
content: '...';
animation: pulseDots 1.4s infinite ease-in-out;
}
@keyframes pulseDots {
0%, 100% { opacity: 0.3; }
30% { opacity: 1; }
60% { opacity: 0.6; }
}
.input-container {
position: fixed;
bottom: 15px;
left: 50%;
transform: translateX(-50%);
display: flex;
align-items: flex-end;
gap: 12px;
width: 94%;
max-width: 1000px;
min-width: 320px;
z-index: 100;
}
.input-area {
flex: 1;
background: rgba(0, 0, 0, 0.45);
border: 1px solid var(--border-color);
border-radius: 25px;
padding: 0 60px 0 16px;
display: flex;
align-items: center;
transition: all .3s;
backdrop-filter: blur(8px);
}
.input-area:focus-within {
border-color: rgba(0, 255, 255, 0.7);
}
textarea {
flex: 1;
resize: none;
padding: 12px 0;
font-size: 17px;
border: none;
outline: none;
background: transparent;
color: #e0ffff;
height: auto;
min-height: 24px;
max-height: 360px;
direction: rtl;
text-align: right;
line-height: 1.6;
font-weight: 600;
box-sizing: border-box;
overflow-y: auto;
word-wrap: break-word;
font-family: "Cairo", sans-serif;
caret-color: #00ffff !important;
}
textarea::selection {
background: rgba(0, 255, 255, 0.3);
}
textarea::-webkit-scrollbar {
width: 6px;
}
textarea::-webkit-scrollbar-track {
background: rgba(0, 255, 255, 0.05);
border-radius: 10px;
}
textarea::-webkit-scrollbar-thumb {
background: rgba(0, 255, 255, 0.3);
border-radius: 10px;
border: 1px solid transparent;
background-clip: padding-box;
}
textarea::-webkit-scrollbar-thumb:hover {
background: rgba(0, 255, 255, 0.5);
}
textarea::placeholder {
color: rgba(0, 255, 255, 0.6);
font-size: 15px;
font-weight: 500;
}
.action-btn {
position: absolute;
right: 10px;
top: 50%;
transform: translateY(-50%);
width: 36px;
height: 36px;
border-radius: 50%;
background: rgba(0, 255, 255, 0.15);
border: 1px solid var(--border-color);
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
transition: all .3s;
z-index: 10;
}
.action-btn:hover {
background: rgba(0, 255, 255, 0.3);
transform: translateY(-50%) scale(1.1);
}
.send-btn {
width: 44px;
height: 44px;
border-radius: 50%;
background: rgba(0, 255, 255, 0.2);
border: 1px solid var(--border-color);
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
transition: all .3s;
}
.send-btn.active {
background: rgba(0, 255, 255, 0.3);
transform: scale(1.1);
}
.send-btn:hover {
background: rgba(0, 255, 255, 0.4);
transform: scale(1.15);
}
.send-icon-img {
width: 22px;
height: 22px;
}
#actionMenu {
position: fixed;
right: 50%;
transform: translateX(50%);
bottom: 75px;
display: flex;
flex-direction: column;
gap: 12px;
transition: all .3s;
opacity: 0;
visibility: hidden;
z-index: 99;
width: 94%;
max-width: 1000px;
align-items: flex-end;
}
#actionMenu.open {
opacity: 1;
visibility: visible;
bottom: 75px;
}
.mic-btn,
.image-btn {
width: 44px;
height: 44px;
border-radius: 50%;
background: rgba(0, 0, 0, 0.7);
border: 2px solid var(--border-color);
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
transition: all .3s;
}
.mic-btn:hover,
.image-btn:hover {
background: rgba(0, 255, 255, 0.15);
transform: scale(1.1);
}
.mic-btn.recording {
background: #ff0050;
animation: pulse 1.5s infinite;
}
@keyframes pulse {
0% {
}
50% {
}
100% {
}
}
.snowflake {
position: absolute;
background: rgba(255, 255, 255, 0.8);
border-radius: 50%;
pointer-events: none;
z-index: 1;
}
/* Personal Profile Section in Chat History */
.personal-profile-section {
background: rgba(0, 255, 255, 0.15);
border: 1px solid var(--border-color);
border-radius: 15px;
padding: 15px;
margin: 10px 0;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}
.personal-profile-section:hover {
background: rgba(0, 255, 255, 0.25);
transform: translateY(-2px);
border-color: rgba(0, 255, 255, 0.6);
}
.personal-profile-section h3 {
margin: 0 0 8px 0;
color: var(--text-color);
font-size: 18px;
display: flex;
align-items: center;
gap: 10px;
}
.personal-profile-section h3::before {
content: "ğŸ‘¤";
font-size: 20px;
}
.personal-profile-section p {
margin: 0;
color: #ccc;
font-size: 14px;
}
.personal-profile-section .edit-icon {
position: absolute;
left: 10px;
top: 50%;
transform: translateY(-50%);
width: 24px;
height: 24px;
background: rgba(0, 255, 255, 0.2);
border-radius: 50%;
display: flex;
justify-content: center;
align-items: center;
color: var(--text-color);
font-size: 14px;
}
/* Favorites Section Header */
.favorites-header {
background: rgba(0, 255, 255, 0.15);
border: 1px solid var(--border-color);
border-radius: 12px;
padding: 10px 15px;
margin: 15px 0 10px 0;
color: var(--text-color);
font-size: 16px;
font-weight: bold;
text-align: center;
}
.favorites-header::before {
content: "â­ ";
}
/* Regular Chats Header */
.chats-header {
background: rgba(0, 255, 255, 0.1);
border: 1px solid var(--border-color);
border-radius: 12px;
padding: 10px 15px;
margin: 15px 0 10px 0;
color: #8ff;
font-size: 16px;
font-weight: bold;
text-align: center;
}
.chats-header::before {
content: "ğŸ’¬ ";
}
/* Chat History Modal */
#chatHistoryModal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85);
display: none;
justify-content: center;
align-items: center;
z-index: 2000;
backdrop-filter: blur(10px);
}
.chat-history-card {
/* Ø¬Ø¹Ù„ Ù„ÙˆÙ† Ø§Ù„ÙƒØ§Ø¯Ø± ÙŠØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© */
background: rgba(10, 5, 20, 0.95);
border: 1px solid var(--border-color);
border-radius: 25px;
padding: 30px;
width: 90%;
max-width: 500px;
direction: rtl;
text-align: center;
max-height: 80vh;
overflow-y: auto;
}
/* Search Bar Styling */
.search-container {
margin-bottom: 20px;
position: relative;
}
#searchInput {
width: 100%;
padding: 12px 15px 12px 40px;
border-radius: 20px;
border: 1px solid var(--border-color);
background: rgba(0, 0, 0, 0.4);
color: var(--text-color);
font-size: 16px;
direction: rtl;
text-align: right;
box-sizing: border-box;
}
#searchInput::placeholder {
color: rgba(0, 255, 255, 0.6);
}
.search-icon {
position: absolute;
left: 15px;
top: 50%;
transform: translateY(-50%);
color: var(--text-color);
font-size: 18px;
}
/* Scrollbar for chat history modal */
.chat-history-card::-webkit-scrollbar {
width: 8px;
}
.chat-history-card::-webkit-scrollbar-track {
background: transparent;
}
.chat-history-card::-webkit-scrollbar-thumb {
background: var(--text-color);
border-radius: 10px;
}
.chat-history-card::-webkit-scrollbar-thumb:hover {
background: rgba(0, 255, 255, 0.7);
}
.chat-history-card h2 {
margin-top: 0;
margin-bottom: 25px;
color: var(--text-color);
font-size: 24px;
border-bottom: 1px solid var(--border-color);
padding-bottom: 15px;
}
.chat-history-item {
background: rgba(0, 0, 0, 0.3);
border: 1px solid var(--border-color);
border-radius: 15px;
padding: 15px;
margin: 10px 0;
cursor: pointer;
transition: all .3s;
position: relative;
}
.chat-history-item:hover {
background: rgba(0, 255, 255, 0.1);
transform: translateY(-2px);
border-color: rgba(0, 255, 255, 0.5);
}
.chat-history-item h3 {
margin: 0 0 8px 0;
color: #8ff;
font-size: 16px;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
.chat-history-item p {
margin: 0;
color: #ccc;
font-size: 14px;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
.chat-history-item .chat-actions {
position: absolute;
left: 10px;
top: 50%;
transform: translateY(-50%);
display: flex;
gap: 8px;
}
.chat-action-btn {
width: 28px;
height: 28px;
border-radius: 50%;
border: none;
background: rgba(0, 255, 255, 0.2);
color: var(--text-color);
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
transition: all .3s;
font-size: 14px;
}
.chat-action-btn:hover {
background: rgba(0, 255, 255, 0.4);
transform: scale(1.1);
}
.chat-action-btn.delete {
background: rgba(255, 0, 80, 0.2);
color: #ff66aa;
}
.chat-action-btn.delete:hover {
background: rgba(255, 0, 80, 0.4);
}
.chat-action-btn.favorite {
background: rgba(255, 215, 0, 0.2);
color: #ffd700;
}
.chat-action-btn.favorite:hover {
background: rgba(255, 215, 0, 0.4);
}
.chat-action-btn.favorite.favorited {
background: rgba(255, 215, 0, 0.6);
color: #fff;
}
.chat-action-btn.edit {
background: rgba(0, 255, 255, 0.2);
color: var(--text-color);
}
.chat-action-btn.edit:hover {
background: rgba(0, 255, 255, 0.4);
}
.close-modal {
position: absolute;
top: 15px;
right: 15px;
width: 30px;
height: 30px;
border-radius: 50%;
background: rgba(255, 0, 80, 0.3);
color: #ff66aa;
border: none;
cursor: pointer;
font-size: 18px;
display: flex;
justify-content: center;
align-items: center;
}
.close-modal:hover {
background: rgba(255, 0, 80, 0.5);
transform: rotate(90deg);
}
/* Profile Modal */
#profileModal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85);
display: none;
justify-content: center;
align-items: center;
z-index: 2000;
backdrop-filter: blur(10px);
}
.profile-card {
/* Ø¬Ø¹Ù„ Ù„ÙˆÙ† Ø§Ù„ÙƒØ§Ø¯Ø± ÙŠØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© */
background: rgba(10, 5, 20, 0.95);
border: 1px solid var(--border-color);
border-radius: 25px;
padding: 30px;
width: 90%;
max-width: 450px;
direction: rtl;
text-align: center;
}
.profile-card h2 {
margin-top: 0;
margin-bottom: 25px;
color: var(--text-color);
font-size: 24px;
}
.form-group {
margin-bottom: 20px;
text-align: right;
}
.form-group label {
display: block;
margin-bottom: 8px;
color: #8ff;
font-size: 16px;
}
.form-group input {
width: 100%;
padding: 12px;
border-radius: 12px;
border: 1px solid var(--border-color);
background: rgba(0, 0, 0, 0.4);
color: #e0ffff;
font-size: 16px;
direction: rtl;
text-align: right;
box-sizing: border-box;
}
.form-group input::placeholder {
color: rgba(0, 255, 255, 0.5);
}
.button-group {
display: flex;
gap: 15px;
justify-content: center;
margin-top: 25px;
}
.btn {
padding: 12px 25px;
border-radius: 20px;
border: none;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all .3s;
font-family: "Cairo", sans-serif;
}
.btn-save {
background: rgba(0, 255, 255, 0.2);
color: var(--text-color);
border: 1px solid var(--border-color);
}
.btn-save:hover {
background: rgba(0, 255, 255, 0.3);
transform: translateY(-2px);
}
.btn-cancel {
background: rgba(255, 0, 80, 0.2);
color: #ff66aa;
border: 1px solid rgba(255, 0, 80, 0.7);
}
.btn-cancel:hover {
background: rgba(255, 0, 80, 0.3);
transform: translateY(-2px);
}
/* Profile Management Buttons */
.profile-management {
margin-top: 20px;
display: flex;
flex-direction: column;
gap: 12px;
}
.profile-btn {
padding: 10px 15px;
border-radius: 15px;
border: none;
font-size: 15px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
font-family: "Cairo", sans-serif;
text-align: center;
}
.btn-logout {
background: rgba(255, 0, 80, 0.2);
color: #ff66aa;
border: 1px solid rgba(255, 0, 80, 0.7);
}
.btn-logout:hover {
background: rgba(255, 0, 80, 0.3);
transform: translateY(-2px);
}
.btn-change-mode {
background: rgba(0, 100, 200, 0.3);
color: #4fc3f7;
border: 1px solid rgba(0, 150, 255, 0.6);
}
.btn-change-mode:hover {
background: rgba(0, 120, 220, 0.5);
transform: translateY(-2px);
}
.btn-snowflakes {
background: rgba(200, 200, 255, 0.3);
color: #bbdefb;
border: 1px solid rgba(200, 200, 255, 0.6);
}
.btn-snowflakes:hover {
background: rgba(220, 220, 255, 0.5);
transform: translateY(-2px);
}
/* Initial Setup Card - Enhanced Animation */
#initialSetupCard {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85);
display: flex;
justify-content: center;
align-items: center;
z-index: 3000;
backdrop-filter: blur(10px);
opacity: 0;
pointer-events: none;
transition: opacity 0.5s ease;
}
#initialSetupCard.visible {
opacity: 1;
pointer-events: all;
}
.initial-setup-card {
/* Ø¬Ø¹Ù„ Ù„ÙˆÙ† Ø§Ù„ÙƒØ§Ø¯Ø± ÙŠØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© */
background: rgba(10, 5, 20, 0.95);
border: 1px solid rgba(0, 150, 255, 0.6);
border-radius: 25px;
padding: 30px;
width: 90%;
max-width: 450px;
direction: rtl;
text-align: center;
transform: translateY(100px) scale(0.8);
opacity: 0;
transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
#initialSetupCard.visible .initial-setup-card {
transform: translateY(0) scale(1);
opacity: 1;
}
.initial-setup-card h2 {
margin-top: 0;
margin-bottom: 25px;
color: #4fc3f7;
font-size: 24px;
}
.initial-form-group {
margin-bottom: 20px;
text-align: right;
}
.initial-form-group label {
display: block;
margin-bottom: 8px;
color: #81d4fa;
font-size: 16px;
}
.initial-form-group input {
width: 100%;
padding: 12px;
border-radius: 12px;
border: 1px solid rgba(0, 150, 255, 0.4);
background: rgba(0, 20, 40, 0.6);
color: #e3f2fd;
font-size: 16px;
direction: rtl;
text-align: right;
box-sizing: border-box;
}
.initial-form-group input::placeholder {
color: rgba(100, 200, 255, 0.7);
}
.initial-button-group {
display: flex;
gap: 15px;
justify-content: center;
margin-top: 25px;
}
.initial-btn {
padding: 12px 25px;
border-radius: 20px;
border: none;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
font-family: "Cairo", sans-serif;
}
.btn-continue {
background: rgba(0, 150, 255, 0.25);
color: #4fc3f7;
border: 1px solid rgba(0, 150, 255, 0.7);
}
.btn-continue:hover {
background: rgba(0, 150, 255, 0.4);
transform: translateY(-2px);
}
.btn-skip {
background: rgba(255, 0, 80, 0.2);
color: #ff66aa;
border: 1px solid rgba(255, 0, 80, 0.7);
}
.btn-skip:hover {
background: rgba(255, 0, 80, 0.3);
transform: translateY(-2px);
}
/* Mode Selection Section */
.mode-selection {
margin: 20px 0;
}
.mode-options {
display: flex;
gap: 15px;
justify-content: center;
flex-wrap: wrap;
}
.mode-option {
background: rgba(0, 30, 60, 0.7);
border: 1px solid rgba(0, 150, 255, 0.4);
border-radius: 15px;
padding: 15px;
cursor: pointer;
transition: all 0.3s ease;
min-width: 120px;
text-align: center;
position: relative;
}
.mode-option:hover {
background: rgba(0, 50, 100, 0.8);
border-color: rgba(0, 150, 255, 0.7);
transform: translateY(-3px);
}
.mode-option.selected {
background: rgba(0, 80, 160, 0.9);
border-color: rgba(0, 200, 255, 0.8);
}
.mode-option h4 {
margin: 0 0 8px 0;
color: #4fc3f7;
font-size: 16px;
display: flex;
justify-content: center;
align-items: center;
gap: 5px;
}
.mode-option p {
margin: 0;
color: #bbdefb;
font-size: 13px;
line-height: 1.4;
}
/* Mode Icons */
.mode-icon {
font-size: 20px;
margin-right: 5px;
}
@media (max-width:768px){
.input-container,#actionMenu{width:96%;max-width:96%}
textarea{font-size:16px;max-height:300px}
.user,.bot{max-width:85%}
.profile-card,.chat-history-card,.initial-setup-card{padding:20px;width:95%}
.form-group input,.initial-form-group input{font-size:15px;padding:10px}
.chat-history-item,.personal-profile-section{padding:12px}
.personal-profile-section h3{font-size:16px}
.favorites-header,.chats-header{font-size:14px;padding:8px 12px}
header{padding:12px 15px;}
#newChatBtn{width:32px;height:32px;font-size:20px;}
.mode-options{gap:10px;}
.mode-option{min-width:100px;padding:12px;}
.search-container{margin-bottom:15px;}
#searchInput{padding:10px 12px 10px 35px;font-size:15px;}
}
@media (max-width:500px){
header{font-size:18px;padding:10px 15px}
.input-container{width:96%;bottom:10px}
textarea{font-size:16px;max-height:270px}
.input-area{padding:0 50px 0 12px;border-radius:20px}
.action-btn{width:32px;height:32px;right:8px}
.send-btn,.mic-btn,.image-btn{width:40px;height:40px}
.user,.bot{max-width:90%;font-size:15px}
.btn,.initial-btn{padding:10px 20px;font-size:15px}
.chat-action-btn{width:24px;height:24px;font-size:12px}
.close-modal{width:26px;height:26px;font-size:16px}
.personal-profile-section{padding:10px}
.personal-profile-section h3{font-size:15px}
.favorites-header,.chats-header{font-size:13px;padding:6px 10px}
.personal-profile-section .edit-icon{width:20px;height:20px;font-size:12px}
#newChatBtn{width:28px;height:28px;font-size:18px;}
.mode-options{flex-direction:column;align-items:center;}
.mode-option{width:80%;}
.profile-management{gap:10px;}
.profile-btn{padding:8px 12px;font-size:14px;}
.search-icon{left:12px;font-size:16px;}
}
</style>
</head>
<body>
<header id="appHeader">
<span>Kalmeron</span>
<div id="newChatBtn">+</div>
</header>
<!-- BANNER Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
<div id="welcomeBanner"></div>
<div id="chat"></div>
<div class="input-container">
<div class="input-area">
<input type="file" id="imageUpload" accept="image/*" style="display:none">
<textarea id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." rows="1"></textarea>
<div class="action-btn" id="actionBtn">
<svg width="24" height="24" viewBox="0 0 24 24" fill="aqua">
<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
</svg>
</div>
</div>
<div class="send-btn" id="sendBtn">
<img src="up-arrow.png" alt="Send" class="send-icon-img">
</div>
</div>
<div id="actionMenu">
<div class="mic-btn" id="micBtn">
<svg width="24" height="24" viewBox="0 0 24 24" fill="aqua">
<path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
<path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
</svg>
</div>
<div class="image-btn" id="imageUploadBtn">
<svg width="24" height="24" viewBox="0 0 24 24" fill="aqua">
<path d="M19 5H5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 12H5l4-5 2.5 3.01L15 11l4 5v-4z"/>
</svg>
</div>
</div>
<!-- Chat History Modal -->
<div id="chatHistoryModal">
<div class="chat-history-card">
<button class="close-modal" id="closeChatHistory">&times;</button>
<!-- Search Bar Instead of Title -->
<div class="search-container">
<div class="search-icon">ğŸ”</div>
<input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª...">
</div>
<div id="chatHistoryList">
<!-- Chat history items will be loaded here -->
</div>
</div>
</div>
<!-- Profile Modal -->
<div id="profileModal">
<div class="profile-card">
<h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
<div class="form-group">
<label for="editName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
<input type="text" id="editName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" maxlength="50">
</div>
<div class="form-group">
<label for="editBirthDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
<input type="date" id="editBirthDate">
</div>
<!-- Profile Management Buttons -->
<div class="profile-management">
<button class="profile-btn btn-change-mode" id="changeModeBtn">ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹</button>
<button class="profile-btn btn-snowflakes" id="snowflakesBtn">Ø¥Ø¯Ø§Ø±Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù„Ø¬</button>
<button class="profile-btn btn-logout" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>
<div class="button-group">
<button class="btn btn-cancel" id="modalCancelBtn">Ø¥Ù„ØºØ§Ø¡</button>
<button class="btn btn-save" id="modalSaveBtn">Ù…ÙˆØ§ÙÙ‚</button>
</div>
</div>
</div>
<!-- Initial Setup Card -->
<div id="initialSetupCard">
<div class="initial-setup-card">
<h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ÙƒØ§Ù„Ù…ÙŠØ±ÙˆÙ†!</h2>
<p style="color:rgba(100,200,255,0.9);margin-bottom:25px;">Ù„ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</p>
<div class="initial-form-group">
<label for="initialName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
<input type="text" id="initialName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" maxlength="50">
</div>
<div class="initial-form-group">
<label for="initialBirthDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
<input type="date" id="initialBirthDate">
</div>
<!-- Mode Selection -->
<div class="mode-selection">
<h3 style="color:#4fc3f7;margin:25px 0 15px 0;font-size:18px;">Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„:</h3>
<div class="mode-options">
<div class="mode-option selected" data-mode="general">
<h4><span class="mode-icon">ğŸŸ£</span> Ø¹Ø§Ù…</h4>
<p>Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø§Ø¯ÙŠØ© Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
</div>
<div class="mode-option" data-mode="science">
<h4><span class="mode-icon">ğŸ”µ</span> Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù„ÙˆÙ…</h4>
<p>Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ØŒ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ</p>
</div>
</div>
</div>
<div class="initial-button-group">
<button class="initial-btn btn-continue" id="continueInitialBtn">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
</div>
</div>
</div>
<script>
// Snowflakes management variables
let snowflakesEnabled = true;
let snowflakesDisabledModes = [];
function createSnowflakes(){
if (snowflakesDisabledModes.includes(selectedMode)) return;
const c=document.body;
for(let i=0;i<50;i++){
const s=document.createElement('div');
s.classList.add('snowflake');
const z=Math.random()*3+1;
s.style.width=`${z}px`;
s.style.height=`${z}px`;
s.style.left=`${Math.random()*100}vw`;
s.style.top=`${-z}px`;
s.style.opacity=Math.random()*.4+.2;
s.style.animation=`fall ${Math.random()*12+8}s linear infinite`;
s.style.setProperty('--horizontal-move',`${(Math.random()-.5)*30}px`);
c.appendChild(s);
}
const t=document.createElement('style');
t.textContent=`@keyframes fall{0%{transform:translateY(0) translateX(0)}100%{transform:translateY(100vh) translateX(var(--horizontal-move,0))}}`;
document.head.appendChild(t);
}
function clearSnowflakes() {
const snowflakes = document.querySelectorAll('.snowflake');
snowflakes.forEach(s => s.remove());
const style = document.querySelector('style[textContent*="@keyframes fall"]');
if (style) style.remove();
}
function toggleSnowflakes() {
showSnowflakesModeSelectionDialog();
}
function showSnowflakesModeSelectionDialog() {
const snowflakesDialog = document.createElement('div');
snowflakesDialog.id = 'snowflakesModeSelectionDialog';
snowflakesDialog.style.cssText = `
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85);
display: flex;
justify-content: center;
align-items: center;
z-index: 3000;
backdrop-filter: blur(10px);
`;
const dialogCard = document.createElement('div');
dialogCard.style.cssText = `
background: rgba(10, 5, 20, 0.95);
border: 1px solid var(--border-color);
border-radius: 25px;
padding: 30px;
width: 90%;
max-width: 450px;
direction: rtl;
text-align: center;
`;
const title = document.createElement('h2');
title.textContent = 'Ø¥Ø¯Ø§Ø±Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù„Ø¬';
title.style.cssText = 'margin-top:0;margin-bottom:25px;color:var(--text-color);font-size:24px;';
const description = document.createElement('p');
description.textContent = 'Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ÙŠØ¸Ù‡Ø± ÙÙŠÙ‡Ø§ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù„Ø¬:';
description.style.cssText = 'margin-bottom:20px;color:#ccc;';
const modeOptionsDiv = document.createElement('div');
modeOptionsDiv.className = 'mode-options';
modeOptionsDiv.style.cssText = 'margin:20px 0;display:flex;gap:15px;justify-content:center;flex-wrap:wrap;';
const generalOption = document.createElement('div');
generalOption.className = 'mode-option';
if (!snowflakesDisabledModes.includes('general')) {
generalOption.classList.add('selected');
}
generalOption.innerHTML = `
<h4><span class="mode-icon">ğŸŸ£</span> Ø¹Ø§Ù…</h4>
<p>Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø§Ø¯ÙŠØ© Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
`;
generalOption.style.cursor = 'pointer';
generalOption.addEventListener('click', () => {
generalOption.classList.toggle('selected');
});
const scienceOption = document.createElement('div');
scienceOption.className = 'mode-option';
if (!snowflakesDisabledModes.includes('science')) {
scienceOption.classList.add('selected');
}
scienceOption.innerHTML = `
<h4><span class="mode-icon">ğŸ”µ</span> Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù„ÙˆÙ…</h4>
<p>Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ØŒ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ</p>
`;
scienceOption.style.cursor = 'pointer';
scienceOption.addEventListener('click', () => {
scienceOption.classList.toggle('selected');
});
modeOptionsDiv.appendChild(generalOption);
modeOptionsDiv.appendChild(scienceOption);
const confirmBtn = document.createElement('button');
confirmBtn.textContent = 'ØªØ£ÙƒÙŠØ¯';
confirmBtn.style.cssText = `
padding: 12px 25px;
border-radius: 20px;
border: none;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
font-family: "Cairo", sans-serif;
background: rgba(0, 150, 255, 0.25);
color: #4fc3f7;
border: 1px solid rgba(0, 150, 255, 0.7);
margin-top: 20px;
`;
confirmBtn.addEventListener('click', () => {
snowflakesDisabledModes = [];
if (!generalOption.classList.contains('selected')) {
snowflakesDisabledModes.push('general');
}
if (!scienceOption.classList.contains('selected')) {
snowflakesDisabledModes.push('science');
}
updateSnowflakesButtonText();
const user = checkUser();
if (user) {
saveUser(user.name, user.birthDate, selectedMode, snowflakesDisabledModes);
}
clearSnowflakes();
if (!snowflakesDisabledModes.includes(selectedMode)) {
setTimeout(createSnowflakes, 100);
}
document.body.removeChild(snowflakesDialog);
});
dialogCard.appendChild(title);
dialogCard.appendChild(description);
dialogCard.appendChild(modeOptionsDiv);
dialogCard.appendChild(confirmBtn);
snowflakesDialog.appendChild(dialogCard);
document.body.appendChild(snowflakesDialog);
}
function updateSnowflakesButtonText() {
if (snowflakesDisabledModes.length === 0) {
snowflakesBtn.textContent = 'ØªØ¹Ø·ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù„Ø¬';
} else if (snowflakesDisabledModes.length === 2) {
snowflakesBtn.textContent = 'ØªÙØ¹ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù„Ø¬';
} else {
snowflakesBtn.textContent = 'Ø¥Ø¯Ø§Ø±Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù„Ø¬';
}
}
const chat=document.getElementById("chat"),msg=document.getElementById("msg"),sendBtn=document.getElementById("sendBtn"),actionBtn=document.getElementById("actionBtn"),actionMenu=document.getElementById("actionMenu"),micBtn=document.getElementById("micBtn"),imageUploadBtn=document.getElementById("imageUploadBtn"),imageUpload=document.getElementById("imageUpload"),appHeader=document.getElementById("appHeader"),profileModal=document.getElementById("profileModal"),editName=document.getElementById("editName"),editBirthDate=document.getElementById("editBirthDate"),modalCancelBtn=document.getElementById("modalCancelBtn"),modalSaveBtn=document.getElementById("modalSaveBtn"),chatHistoryModal=document.getElementById("chatHistoryModal"),chatHistoryList=document.getElementById("chatHistoryList"),closeChatHistory=document.getElementById("closeChatHistory"),newChatBtn=document.getElementById("newChatBtn");
const logoutBtn = document.getElementById("logoutBtn");
const changeModeBtn = document.getElementById("changeModeBtn");
const snowflakesBtn = document.getElementById("snowflakesBtn");
const searchInput = document.getElementById("searchInput");
const initialSetupCard = document.getElementById("initialSetupCard");
const initialName = document.getElementById("initialName");
const initialBirthDate = document.getElementById("initialBirthDate");
const continueInitialBtn = document.getElementById("continueInitialBtn");
const modeOptions = document.querySelectorAll('.mode-option');
const welcomeBanner = document.getElementById("welcomeBanner");
let isThinking=false;
let currentChatId = null;
let selectedMode = 'general';
modeOptions.forEach(option => {
option.addEventListener('click', () => {
modeOptions.forEach(opt => opt.classList.remove('selected'));
option.classList.add('selected');
selectedMode = option.dataset.mode;
updateBodyClass();
});
});
function updateBodyClass() {
document.body.className = `mode-${selectedMode}`;
clearSnowflakes();
if (!snowflakesDisabledModes.includes(selectedMode)) {
setTimeout(createSnowflakes, 100);
}
}
function checkUser(){const d=localStorage.getItem('kalmeronUserData');return d?JSON.parse(d):null;}
function saveUser(n,b,m,snowDisabledModes){localStorage.setItem('kalmeronUserData',JSON.stringify({name:n,birthDate:b,mode:m||'general',snowflakesDisabledModes: snowDisabledModes || [],registeredAt:new Date().toISOString()}));}
function clearUser(){localStorage.removeItem('kalmeronUserData');}
function createPersonalProfileSection() {
const profileSection = document.createElement('div');
profileSection.className = 'personal-profile-section';
const user = checkUser();
const displayName = user && user.name !== 'Ø²Ø§Ø¦Ø±' ? user.name : 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ';
profileSection.innerHTML = `
<h3>${displayName}</h3>
<p>Ø§Ø¶ØºØ· Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ</p>
<div class="edit-icon">âœï¸</div>
`;
profileSection.addEventListener('click', () => {
showProfile();
});
return profileSection;
}
function showProfile(){
const u=checkUser();
if(u){
editName.value=u.name;
editBirthDate.value=u.birthDate;
snowflakesDisabledModes = u.snowflakesDisabledModes || [];
updateSnowflakesButtonText();
profileModal.style.display='flex';
}
}
function startNewChat() {
chat.innerHTML = '';
currentChatId = null;
const user = checkUser();
loadWelcome(user);
}
function generateChatId() {
return 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}
function getCurrentChatTitle() {
const firstUserMsg = document.querySelector('.msg.user');
if (firstUserMsg && firstUserMsg.textContent.trim()) {
return firstUserMsg.textContent.trim().substring(0, 30) + (firstUserMsg.textContent.length > 30 ? '...' : '');
}
return 'Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©';
}
function saveCurrentChat() {
if (!chat.children.length) return null;
const chatMessages = [];
const messages = chat.querySelectorAll('.msg, .bot-response');
messages.forEach(msg => {
const sender = msg.classList.contains('user') ? 'user' : 'bot';
chatMessages.push({
sender: sender,
content: msg.textContent
});
});
const chatData = {
id: currentChatId || generateChatId(),
title: getCurrentChatTitle(),
messages: chatMessages,
timestamp: new Date().toISOString(),
favorited: false,
mode: selectedMode
};
const chats = JSON.parse(localStorage.getItem('kalmeronChats') || '[]');
const existingIndex = chats.findIndex(c => c.id === chatData.id);
if (existingIndex !== -1) {
chats[existingIndex] = chatData;
} else {
chats.unshift(chatData);
if (chats.length > 50) chats.splice(50);
}
localStorage.setItem('kalmeronChats', JSON.stringify(chats));
currentChatId = chatData.id;
return chatData.id;
}
function loadChatHistory(filter = '') {
const chats = JSON.parse(localStorage.getItem('kalmeronChats') || '[]');
chatHistoryList.innerHTML = '';
const personalProfileSection = createPersonalProfileSection();
chatHistoryList.appendChild(personalProfileSection);
if (chats.length === 0) {
chatHistoryList.innerHTML += '<p style="color:rgba(0,255,255,0.6);margin:20px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</p>';
return;
}
let filteredChats = chats;
if (filter.trim() !== '') {
filteredChats = chats.filter(chat =>
chat.title.toLowerCase().includes(filter.toLowerCase()) ||
(new Date(chat.timestamp)).toLocaleDateString('ar-EG').includes(filter) ||
(new Date(chat.timestamp)).toLocaleTimeString('ar-EG', {hour:'2-digit',minute:'2-digit'}).includes(filter)
);
}
if (filteredChats.length === 0) {
chatHistoryList.innerHTML += '<p style="color:rgba(0,255,255,0.6);margin:20px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>';
return;
}
const favorites = filteredChats.filter(chat => chat.favorited);
const regularChats = filteredChats.filter(chat => !chat.favorited);
if (favorites.length > 0) {
const favoritesHeader = document.createElement('div');
favoritesHeader.className = 'favorites-header';
favoritesHeader.textContent = 'Ø§Ù„Ù…ÙØ¶Ù„Ø©';
chatHistoryList.appendChild(favoritesHeader);
favorites.forEach(chat => {
addChatItem(chat);
});
}
if (regularChats.length > 0) {
const chatsHeader = document.createElement('div');
chatsHeader.className = 'chats-header';
chatsHeader.textContent = 'Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰';
chatHistoryList.appendChild(chatsHeader);
regularChats.forEach(chat => {
addChatItem(chat);
});
}
}
function addChatItem(chat) {
const chatItem = document.createElement('div');
chatItem.className = 'chat-history-item';
chatItem.dataset.chatId = chat.id;
const date = new Date(chat.timestamp);
const formattedDate = date.toLocaleDateString('ar-EG') + ' ' + date.toLocaleTimeString('ar-EG', {hour:'2-digit',minute:'2-digit'});
chatItem.innerHTML = `
<div class="chat-actions">
<button class="chat-action-btn favorite" data-chat-id="${chat.id}">
${chat.favorited ? 'â˜…' : 'â˜†'}
</button>
<button class="chat-action-btn edit" data-chat-id="${chat.id}">âœï¸</button>
<button class="chat-action-btn delete" data-chat-id="${chat.id}">Ã—</button>
</div>
<h3>${chat.title}</h3>
<p>${formattedDate}</p>
`;
chatItem.addEventListener('click', (e) => {
if (!e.target.closest('.chat-action-btn')) {
loadChat(chat.id);
chatHistoryModal.style.display = 'none';
}
});
const favoriteBtn = chatItem.querySelector('.chat-action-btn.favorite');
const editBtn = chatItem.querySelector('.chat-action-btn.edit');
const deleteBtn = chatItem.querySelector('.chat-action-btn.delete');
favoriteBtn.addEventListener('click', (e) => {
e.stopPropagation();
toggleFavoriteChat(chat.id);
});
editBtn.addEventListener('click', (e) => {
e.stopPropagation();
editChatTitle(chat.id);
});
deleteBtn.addEventListener('click', (e) => {
e.stopPropagation();
deleteChat(chat.id);
});
chatHistoryList.appendChild(chatItem);
}
function editChatTitle(chatId) {
const chats = JSON.parse(localStorage.getItem('kalmeronChats') || '[]');
const chatIndex = chats.findIndex(c => c.id === chatId);
if (chatIndex !== -1) {
const newTitle = prompt('Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù†Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:', chats[chatIndex].title);
if (newTitle !== null && newTitle.trim() !== '') {
chats[chatIndex].title = newTitle.trim();
localStorage.setItem('kalmeronChats', JSON.stringify(chats));
loadChatHistory(searchInput.value);
}
}
}
function loadChat(chatId) {
const chats = JSON.parse(localStorage.getItem('kalmeronChats') || '[]');
const chatToLoad = chats.find(c => c.id === chatId);
if (chatToLoad) {
chat.innerHTML = '';
selectedMode = chatToLoad.mode || 'general';
updateBodyClass();
chatToLoad.messages.forEach(msg => {
const msgDiv = document.createElement('div');
msgDiv.className = `${msg.sender === 'user' ? 'msg user' : 'bot-response'}`;
msgDiv.textContent = msg.content;
chat.appendChild(msgDiv);
});
currentChatId = chatId;
chat.scrollTop = chat.scrollHeight;
}
}
function toggleFavoriteChat(chatId) {
const chats = JSON.parse(localStorage.getItem('kalmeronChats') || '[]');
const chatIndex = chats.findIndex(c => c.id === chatId);
if (chatIndex !== -1) {
chats[chatIndex].favorited = !chats[chatIndex].favorited;
localStorage.setItem('kalmeronChats', JSON.stringify(chats));
loadChatHistory(searchInput.value);
}
}
function deleteChat(chatId) {
if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ')) {
const chats = JSON.parse(localStorage.getItem('kalmeronChats') || '[]');
const filteredChats = chats.filter(c => c.id !== chatId);
localStorage.setItem('kalmeronChats', JSON.stringify(filteredChats));
if (currentChatId === chatId) {
chat.innerHTML = '';
currentChatId = null;
const user = checkUser();
loadWelcome(user);
}
loadChatHistory(searchInput.value);
}
}
function hideProfile(){profileModal.style.display='none';}
function hideChatHistory(){chatHistoryModal.style.display='none';}
function showWelcomeBanner(text) {
welcomeBanner.textContent = text;
welcomeBanner.classList.add('show');
setTimeout(() => {
welcomeBanner.classList.add('hide');
setTimeout(() => {
welcomeBanner.classList.remove('show', 'hide');
}, 400);
}, 2000);
}
function loadWelcome(u){
let w;
switch(selectedMode) {
case 'science':
w = u ? `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ØŒ ${u.name}! ğŸŒŸ` : 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù„ÙˆÙ…!';
break;
default:
w = u ? `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ØŒ ${u.name}! ğŸŒŸ` : 'Ø§Ù‡Ù„Ø§ Ø¨Ùƒ ÙÙŠ ÙƒØ§Ù„Ù…ÙŠØ±ÙˆÙ†!';
}
showWelcomeBanner(w);
setTimeout(()=>msg.focus(),500);
}
function adjustHeight(){msg.style.height='auto';const h=window.innerWidth<=500?270:360;msg.style.height=Math.min(msg.scrollHeight,h)+'px';msg.style.overflowY=msg.scrollHeight>h?'auto':'hidden';}
function updateSendBtn(){sendBtn.classList.toggle('active',!!(msg.value.trim()||imageUpload.files.length>0));}
function closeActionMenu(){actionMenu.classList.remove('open');actionBtn.classList.remove('active');}
modalSaveBtn.addEventListener('click',()=>{const n=editName.value.trim(),b=editBirthDate.value;if(!n||!b)return;const d=new Date(b),t=new Date(),m=new Date();m.setFullYear(m.getFullYear()-120);if(d>=t||d<m)return;saveUser(n,b,selectedMode,snowflakesDisabledModes);hideProfile();chat.innerHTML='';loadWelcome({name:n});});
modalCancelBtn.addEventListener('click',hideProfile);
closeChatHistory.addEventListener('click',hideChatHistory);
appHeader.addEventListener('click',()=>{loadChatHistory();chatHistoryModal.style.display='flex';});
newChatBtn.addEventListener('click', (e) => {
e.stopPropagation();
startNewChat();
});
logoutBtn.addEventListener('click', () => {
if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
clearUser();
location.reload();
}
});
changeModeBtn.addEventListener('click', () => {
hideProfile();
showModeSelectionDialog();
});
snowflakesBtn.addEventListener('click', toggleSnowflakes);
searchInput.addEventListener('input', (e) => {
loadChatHistory(e.target.value);
});
actionBtn.addEventListener('click',()=>{if(isThinking)return;actionMenu.classList.toggle('open');actionBtn.classList.toggle('active');});
imageUploadBtn.addEventListener('click',()=>{closeActionMenu();imageUpload.click();});
imageUpload.addEventListener('change',updateSendBtn);
sendBtn.addEventListener('click',()=>{if(msg.value.trim()&&!isThinking)sendMessage();});
msg.addEventListener("keydown",(e)=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();if(msg.value.trim()&&!isThinking)sendMessage();}});
msg.addEventListener("input",()=>{adjustHeight();updateSendBtn();});

function sendMessage(){
const t = msg.value.trim();
if (!t) return;

// Add new user message
const u = document.createElement("div");
u.className = "msg user";
u.textContent = t;
chat.appendChild(u);

// Clear input
msg.value = "";
adjustHeight();
updateSendBtn();

// Add animated "thinking..." message WITHOUT bubble â€” just floating text
const thinkingMsg = document.createElement("div");
thinkingMsg.className = "bot-response";
thinkingMsg.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±<span class="thinking-dots"></span>';
chat.appendChild(thinkingMsg);
chat.scrollTop = chat.scrollHeight;

isThinking = true;

// Simulate AI response after 3 seconds
setTimeout(() => {
// Remove the thinking message
if (thinkingMsg.parentNode) {
chat.removeChild(thinkingMsg);
}

// Create real response WITHOUT bubble â€” aligned under user message
const b = document.createElement("div");
b.className = "bot-response";
let responseText;
switch(selectedMode){
case 'science':
responseText = 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø¹Ù„Ù…ÙŠØŒ Ø¥Ù„ÙŠÙƒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ù…Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª...';
break;
default:
responseText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ù†Ø§ ÙƒØ§Ù„Ù…ÙŠØ±ÙˆÙ†! Ø¬Ø§Ù‡Ø² Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª ğŸ’™';
}
b.textContent = responseText;
chat.appendChild(b);
chat.scrollTop = chat.scrollHeight;
isThinking = false;
saveCurrentChat();
}, 3000);
}

setInterval(() => {
if (chat.children.length > 0) {
saveCurrentChat();
}
}, 30000);
function showModeSelectionDialog() {
const modeDialog = document.createElement('div');
modeDialog.id = 'modeSelectionDialog';
modeDialog.style.cssText = `
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85);
display: flex;
justify-content: center;
align-items: center;
z-index: 3000;
backdrop-filter: blur(10px);
`;
const dialogCard = document.createElement('div');
dialogCard.style.cssText = `
background: rgba(10, 5, 20, 0.95);
border: 1px solid var(--border-color);
border-radius: 25px;
padding: 30px;
width: 90%;
max-width: 450px;
direction: rtl;
text-align: center;
`;
const title = document.createElement('h2');
title.textContent = 'Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„';
title.style.cssText = 'margin-top:0;margin-bottom:25px;color:var(--text-color);font-size:24px;';
const modeOptionsDiv = document.createElement('div');
modeOptionsDiv.className = 'mode-options';
modeOptionsDiv.style.cssText = 'margin:20px 0;display:flex;gap:15px;justify-content:center;flex-wrap:wrap;';
const generalOption = document.createElement('div');
generalOption.className = 'mode-option';
generalOption.dataset.mode = 'general';
generalOption.innerHTML = `
<h4><span class="mode-icon">ğŸŸ£</span> Ø¹Ø§Ù…</h4>
<p>Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø§Ø¯ÙŠØ© Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
`;
generalOption.style.cursor = 'pointer';
const scienceOption = document.createElement('div');
scienceOption.className = 'mode-option';
scienceOption.dataset.mode = 'science';
scienceOption.innerHTML = `
<h4><span class="mode-icon">ğŸ”µ</span> Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù„ÙˆÙ…</h4>
<p>Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ØŒ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ</p>
`;
scienceOption.style.cursor = 'pointer';
if (selectedMode === 'general') {
generalOption.classList.add('selected');
} else {
scienceOption.classList.add('selected');
}
modeOptionsDiv.appendChild(generalOption);
modeOptionsDiv.appendChild(scienceOption);
generalOption.addEventListener('click', () => {
modeOptionsDiv.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('selected'));
generalOption.classList.add('selected');
selectedMode = 'general';
});
scienceOption.addEventListener('click', () => {
modeOptionsDiv.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('selected'));
scienceOption.classList.add('selected');
selectedMode = 'science';
});
const confirmBtn = document.createElement('button');
confirmBtn.textContent = 'ØªØ£ÙƒÙŠØ¯';
confirmBtn.style.cssText = `
padding: 12px 25px;
border-radius: 20px;
border: none;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
font-family: "Cairo", sans-serif;
background: rgba(0, 150, 255, 0.25);
color: #4fc3f7;
border: 1px solid rgba(0, 150, 255, 0.7);
margin-top: 20px;
`;
confirmBtn.addEventListener('click', () => {
updateBodyClass();
const user = checkUser();
if (user) {
saveUser(user.name, user.birthDate, selectedMode, snowflakesDisabledModes);
}
chat.innerHTML = '';
loadWelcome(user);
document.body.removeChild(modeDialog);
});
dialogCard.appendChild(title);
dialogCard.appendChild(modeOptionsDiv);
dialogCard.appendChild(confirmBtn);
modeDialog.appendChild(dialogCard);
document.body.appendChild(modeDialog);
}
function handleInitialSetup() {
const userData = checkUser();
if (userData) {
selectedMode = userData.mode || 'general';
snowflakesDisabledModes = userData.snowflakesDisabledModes || [];
updateBodyClass();
if (!snowflakesDisabledModes.includes(selectedMode)) {
createSnowflakes();
}
initialSetupCard.style.display = 'none';
loadWelcome(userData);
return;
}
setTimeout(() => {
initialSetupCard.classList.add('visible');
}, 300);
const minDate = new Date();
minDate.setFullYear(minDate.getFullYear() - 120);
initialBirthDate.min = minDate.toISOString().split('T')[0];
const maxDate = new Date();
initialBirthDate.max = maxDate.toISOString().split('T')[0];
continueInitialBtn.addEventListener('click', () => {
const name = initialName.value.trim();
const birthDate = initialBirthDate.value;
if (!name || !birthDate) {
alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
return;
}
const birthDateObj = new Date(birthDate);
const today = new Date();
const minBirthDate = new Date();
minBirthDate.setFullYear(today.getFullYear() - 120);
if (birthDateObj > today || birthDateObj < minBirthDate) {
alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ ØµØ­ÙŠØ­');
return;
}
saveUser(name, birthDate, selectedMode, snowflakesDisabledModes);
initialSetupCard.classList.remove('visible');
setTimeout(() => {
initialSetupCard.style.display = 'none';
loadWelcome({name: name});
createSnowflakes();
}, 300);
});
}
window.onload = () => {
handleInitialSetup();
};
document.addEventListener('click',(e)=>{if(!actionBtn.contains(e.target)&&!actionMenu.contains(e.target))closeActionMenu();});
window.addEventListener('resize',adjustHeight);
document.addEventListener('keydown',(e)=>{if(profileModal.style.display==='flex'&&e.key==='Enter'){e.preventDefault();modalSaveBtn.click();}});
</script>
</body>
</html>


