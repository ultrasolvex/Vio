<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</title>
  <style>
    :root {
      --primary: #4b0082;
      --secondary: #8a2be2;
      --accent: #00d4ff;
      --light: #f8f9ff;
      --dark: #1a0033;
      --success: #00ff9d;
      --danger: #ff4757;
      --warning: #ffa502;
      --gray: #6c757d;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
      color: var(--light);
      min-height: 100vh;
      padding: 20px;
      padding-bottom: 100px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-top: 10px;
    }
    .header h1 {
      font-size: clamp(28px, 5vw, 42px);
      color: var(--accent);
      margin-bottom: 10px;
    }
    .header p {
      color: rgba(255, 255, 255, 0.7);
      font-size: clamp(14px, 3vw, 18px);
    }
    .phase {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    .phase.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .btn:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--secondary), var(--primary));
    }
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      box-shadow: 0 10px 20px rgba(138, 43, 226, 0.3);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .input-group input {
      flex: 1;
      min-width: 200px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(0, 212, 255, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 16px;
    }
    .input-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
    }
    .tasks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .task-card {
      border-radius: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #4b0082, #6a0dad);
      transition: transform 0.3s ease;
      position: relative;
    }
    .task-card:hover {
      transform: translateY(-5px);
    }
    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    .task-title {
      font-size: 18px;
      font-weight: 600;
      color: white;
    }
    .btn-delete {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-delete:hover {
      background: rgba(255, 71, 87, 0.3);
      transform: scale(1.05);
    }
    .subtasks-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
    }
    .subtask {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .subtask:hover {
      background: rgba(255, 255, 255, 0.15);
    }
    .subtask-name {
      flex: 1;
      color: rgba(255, 255, 255, 0.9);
    }
    .subtask-input-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .subtask-input-group input {
      flex: 1;
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
    }
    .subtask-input-group input:focus {
      outline: none;
      border-color: var(--accent);
    }
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 255, 255, 0.5);
      display: none;
    }
    .execution-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 30px;
    }
    @media (min-width: 992px) {
      .execution-container {
        grid-template-columns: 2fr 1fr;
      }
    }
    .tasks-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }
    @media (max-width: 768px) {
      .tasks-container {
        grid-template-columns: 1fr;
      }
    }
    .execution-card {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(0, 212, 255, 0.2);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .subtask-check {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      cursor: pointer;
    }
    .subtask-check:hover {
      background: rgba(0, 212, 255, 0.1);
    }
    .subtask-check input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: var(--accent);
      cursor: pointer;
    }
    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--success));
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    .stats-panel {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(0, 212, 255, 0.2);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .circular-progress {
      position: relative;
      width: 180px;
      height: 180px;
      margin: 0 auto;
    }
    .progress-circle {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }
    .progress-circle-bg {
      fill: none;
      stroke: rgba(255, 255, 255, 0.1);
      stroke-width: 8;
    }
    .progress-circle-fill {
      fill: none;
      stroke: var(--accent);
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 565;
      stroke-dashoffset: 565;
      transition: stroke-dashoffset 0.8s ease;
    }
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    .progress-percent {
      font-size: 36px;
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }
    .progress-label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 5px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
    .stat-card {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    .stat-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 5px;
    }

    /* Pomodoro Styles */
    .pomodoro-container {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(0, 212, 255, 0.2);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
    }
    .pomodoro-container h2 {
      color: var(--accent);
      margin-bottom: 15px;
    }
    #timerDisplay {
      font-size: 48px;
      font-weight: 700;
      color: var(--success);
      margin-bottom: 15px;
      text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
    }
    .pomodoro-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
    }
    #pomoStatus {
      font-size: 18px;
      color: var(--warning);
      font-weight: 600;
    }

    /* Settings Section */
    .pomodoro-settings {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .setting-input {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    .setting-input label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
    }
    .setting-input input {
      width: 80px;
      padding: 8px;
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 8px;
      color: white;
    }
    .setting-input input:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* Bottom Dock Styles */
    #bottom-dock {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 320px;
      height: 70px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    .kalmeron-link {
      font-size: 26px;
      font-weight: 900;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: aqua;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.4s ease;
      text-shadow: 0 2px 10px rgba(0, 255, 255, 0.4);
      padding: 0 15px;
      background: none;
    }
    .kalmeron-link:hover {
      transform: scale(1.08);
      text-shadow: 0 4px 15px rgba(98, 40, 215, 0.6);
      filter: brightness(1.15);
    }
    @media (max-width: 768px) {
      body {
        padding: 15px;
        padding-bottom: 85px;
      }
      .input-group,
      .controls {
        flex-direction: column;
        align-items: center;
      }
      .btn,
      .input-group input {
        width: 100%;
      }
      #bottom-dock {
        width: 95%;
        max-width: 300px;
        height: 65px;
        bottom: 15px;
      }
      .kalmeron-link {
        font-size: 22px;
        letter-spacing: 2px;
      }
      .pomodoro-settings {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Setup Phase -->
    <div class="phase active" id="setupPhase">
      <div class="header">
        <h1>ğŸ“‹ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h1>
        <p>Ø£Ù†Ø´Ø¦ Ø®Ø·ØªÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙˆØ£Ø¶Ù Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©</p>
      </div>
      <div class="input-group">
        <input type="text" id="taskInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø£Ùˆ Ø§Ù„Ù…Ù‡Ù…Ø©..." />
        <button class="btn btn-primary" id="addTaskBtn">
          <span>Ø¥Ø¶Ø§ÙØ©</span>
        </button>
      </div>
      <div class="tasks-grid" id="tasksGrid"></div>
      <div class="empty-state" id="emptyState">
        <p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ù…Ù‡Ø§Ù… Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!</p>
      </div>
      <div style="text-align: center; margin-top: 30px;">
        <button class="btn btn-primary" id="startBtn" disabled>
          <span>ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</span>
        </button>
      </div>
    </div>

    <!-- Execution Phase -->
    <div class="phase" id="executionPhase">
      <div class="header">
        <h1>ğŸ“Š ØªØªØ¨Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h1>
        <p>Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© ÙˆØªØ§Ø¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ</p>
      </div>

      <!-- Pomodoro Section -->
      <div class="pomodoro-container">
        <h2>ØªÙ‚Ù†ÙŠØ© Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ</h2>
        <div id="timerDisplay">25:00</div>
        <div class="pomodoro-controls">
          <button class="btn btn-primary" id="startPomo">Ø§Ø¨Ø¯Ø£</button>
          <button class="btn" id="pausePomo">Ø¥ÙŠÙ‚Ø§Ù</button>
          <button class="btn" id="resetPomo">Ø¥Ø¹Ø§Ø¯Ø©</button>
        </div>
        <div class="pomodoro-settings">
          <div class="setting-input">
            <label>ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„ (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
            <input type="number" id="workMinutes" min="1" value="25" />
          </div>
          <div class="setting-input">
            <label>ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø© (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
            <input type="number" id="breakMinutes" min="1" value="5" />
          </div>
        </div>
        <span id="pomoStatus">Ø¹Ù…Ù„</span>
      </div>

      <div class="execution-container">
        <div class="tasks-container" id="tasksContainer"></div>
        <div class="stats-panel">
          <div class="circular-progress">
            <svg class="progress-circle" viewBox="0 0 200 200">
              <circle class="progress-circle-bg" cx="100" cy="100" r="90"></circle>
              <circle id="progressRing" class="progress-circle-fill" cx="100" cy="100" r="90"></circle>
            </svg>
            <div class="progress-text">
              <span class="progress-percent" id="progressPercent">0%</span>
              <div class="progress-label" id="progressLabel">Ù„Ù… ÙŠØ¨Ø¯Ø£</div>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-value" id="completedCount">0</span>
              <div class="stat-label">Ù…ÙƒØªÙ…Ù„</div>
            </div>
            <div class="stat-card">
              <span class="stat-value" id="totalCount">0</span>
              <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
            </div>
          </div>
          <div class="controls">
            <button class="btn" id="resetBtn">
              <span>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
            </button>
            <button class="btn" id="backBtn">
              <span>Ø§Ù„Ø¹ÙˆØ¯Ø©</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Dock -->
  <div id="bottom-dock">
    <a class="kalmeron-link" onclick="history.back();">Kalmeron AI</a>
  </div>

  <script>
    let tasks = [];
    const tasksKey = 'studyTasks';
    const phaseKey = 'studyPhase';
    const setupPhase = document.getElementById('setupPhase');
    const executionPhase = document.getElementById('executionPhase');
    const taskInput = document.getElementById('taskInput');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const tasksGrid = document.getElementById('tasksGrid');
    const emptyState = document.getElementById('emptyState');
    const startBtn = document.getElementById('startBtn');
    const tasksContainer = document.getElementById('tasksContainer');
    const progressRing = document.getElementById('progressRing');
    const progressPercent = document.getElementById('progressPercent');
    const progressLabel = document.getElementById('progressLabel');
    const completedCount = document.getElementById('completedCount');
    const totalCount = document.getElementById('totalCount');
    const resetBtn = document.getElementById('resetBtn');
    const backBtn = document.getElementById('backBtn');

    // Pomodoro Elements
    const timerDisplay = document.getElementById('timerDisplay');
    const pomoStatus = document.getElementById('pomoStatus');
    const startPomo = document.getElementById('startPomo');
    const pausePomo = document.getElementById('pausePomo');
    const resetPomo = document.getElementById('resetPomo');
    const workMinutesInput = document.getElementById('workMinutes');
    const breakMinutesInput = document.getElementById('breakMinutes');

    // Pomodoro State
    let timerInterval;
    let isRunning = false;
    let currentTime = 25 * 60;
    let isWork = true;
    let workTime = 25 * 60;
    let breakTime = 5 * 60;

    function init() {
      loadData();
      attachEvents();
      renderSetup();
      const savedPhase = localStorage.getItem(phaseKey);
      if (savedPhase === 'execution' && tasks.length > 0) startExecution();
    }

    function loadData() {
      const saved = localStorage.getItem(tasksKey);
      if (saved) {
        try {
          tasks = JSON.parse(saved);
          tasks.forEach(task => {
            task.subtasks = (task.subtasks || []).map(st => ({ ...st, completed: !!st.completed }));
          });
        } catch (e) {
          tasks = [];
        }
      }
      emptyState.style.display = tasks.length ? 'none' : 'block';

      // Load Pomodoro settings
      const savedWork = localStorage.getItem('pomoWorkMinutes');
      const savedBreak = localStorage.getItem('pomoBreakMinutes');
      if (savedWork) workMinutesInput.value = parseInt(savedWork) || 25;
      if (savedBreak) breakMinutesInput.value = parseInt(savedBreak) || 5;
      applyPomodoroSettings();
    }

    function saveData() {
      localStorage.setItem(tasksKey, JSON.stringify(tasks));
      localStorage.setItem('pomoWorkMinutes', workMinutesInput.value);
      localStorage.setItem('pomoBreakMinutes', breakMinutesInput.value);
    }

    function attachEvents() {
      addTaskBtn.addEventListener('click', addTask);
      taskInput.addEventListener('keypress', (e) => e.key === 'Enter' && addTask());
      startBtn.addEventListener('click', startExecution);
      resetBtn.addEventListener('click', resetProgress);
      backBtn.addEventListener('click', goBack);
      window.addEventListener('beforeunload', saveData);

      // Pomodoro Events
      startPomo.addEventListener('click', startTimer);
      pausePomo.addEventListener('click', pauseTimer);
      resetPomo.addEventListener('click', resetTimer);
      workMinutesInput.addEventListener('change', applyPomodoroSettings);
      breakMinutesInput.addEventListener('change', applyPomodoroSettings);
    }

    function applyPomodoroSettings() {
      const w = parseInt(workMinutesInput.value) || 25;
      const b = parseInt(breakMinutesInput.value) || 5;
      workTime = Math.max(1, w) * 60;
      breakTime = Math.max(1, b) * 60;
      if (!isRunning) {
        isWork = true;
        currentTime = workTime;
        updateDisplay();
      }
    }

    function addTask() {
      const name = taskInput.value.trim();
      if (!name) return;
      tasks.push({
        id: Date.now(),
        name,
        subtasks: [],
        colorIndex: (tasks.length % 5) + 1
      });
      taskInput.value = '';
      renderSetup();
      saveData();
    }

    function deleteTask(id) {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ')) {
        tasks = tasks.filter(t => t.id !== id);
        renderSetup();
        saveData();
      }
    }

    function addSubtask(taskId, input) {
      const name = input.value.trim();
      if (!name) return;
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.subtasks.push({ name, completed: false });
        input.value = '';
        renderSetup();
        saveData();
      }
    }

    function deleteSubtask(taskId, index) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.subtasks.splice(index, 1);
        renderSetup();
        saveData();
      }
    }

    function renderSetup() {
      const hasSubtasks = tasks.length > 0 && tasks.every(t => t.subtasks.length > 0);
      startBtn.disabled = !hasSubtasks;
      emptyState.style.display = tasks.length ? 'none' : 'block';
      tasksGrid.innerHTML = tasks.map(task => `
        <div class="task-card" style="background: linear-gradient(135deg, ${['#4b0082','#5a2d8c','#3d0066','#2d004d','#1a0033'][task.colorIndex-1]}, ${['#6a0dad','#7b3fe4','#8a2be2','#6a0dad','#4b0082'][task.colorIndex-1]});">
          <div class="task-header">
            <div class="task-title">${task.name}</div>
            <button class="btn-delete" onclick="deleteTask(${task.id})">
              âœ•
            </button>
          </div>
          <div class="subtask-input-group">
            <input type="text" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø© ÙØ±Ø¹ÙŠØ©..." onkeypress="if(event.key==='Enter') addSubtask(${task.id}, this)">
            <button class="btn" onclick="addSubtask(${task.id}, this.previousElementSibling)">
              +
            </button>
          </div>
          ${task.subtasks.length ? `
            <div class="subtasks-list">
              ${task.subtasks.map((st, i) => `
                <div class="subtask">
                  <div class="subtask-name">${st.name}</div>
                  <button class="btn-delete" onclick="deleteSubtask(${task.id}, ${i})">
                    âœ•
                  </button>
                </div>
              `).join('')}
            </div>
          ` : '<p style="color: rgba(255,255,255,0.7); text-align: center; padding: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙØ±Ø¹ÙŠØ©</p>'}
        </div>
      `).join('');
    }

    function startExecution() {
      localStorage.setItem(phaseKey, 'execution');
      setupPhase.classList.remove('active');
      executionPhase.classList.add('active');
      renderExecution();
      updateProgress();
      resetTimer();
    }

    function renderExecution() {
      const total = tasks.reduce((sum, task) => sum + task.subtasks.length, 0);
      totalCount.textContent = total;
      tasksContainer.innerHTML = tasks.map(task => {
        const completed = task.subtasks.filter(st => st.completed).length;
        const percent = task.subtasks.length ? Math.round((completed / task.subtasks.length) * 100) : 0;
        return `
          <div class="execution-card">
            <div class="task-progress-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
              <div class="task-title">${task.name}</div>
              <div style="color: var(--accent); font-weight: 600;">${completed}/${task.subtasks.length} (${percent}%)</div>
            </div>
            ${task.subtasks.map((st, i) => `
              <label class="subtask-check">
                <input type="checkbox" ${st.completed ? 'checked' : ''} onchange="toggleSubtask(${task.id}, ${i}, this.checked)">
                <span style="color: ${st.completed ? 'var(--success)' : 'white'}">${st.name}</span>
              </label>
            `).join('')}
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${percent}%"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleSubtask(taskId, index, checked) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.subtasks[index].completed = checked;
        saveData();
        updateProgress();
        renderExecution();
      }
    }

    function updateProgress() {
      let completed = 0, total = 0;
      tasks.forEach(task => {
        task.subtasks.forEach(st => {
          total++;
          if (st.completed) completed++;
        });
      });
      const percent = total ? Math.round((completed / total) * 100) : 0;
      progressPercent.textContent = `${percent}%`;
      completedCount.textContent = completed;
      if (percent === 0) progressLabel.textContent = 'Ù„Ù… ÙŠØ¨Ø¯Ø£';
      else if (percent < 50) progressLabel.textContent = 'ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©';
      else if (percent < 100) progressLabel.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø¯Ù…';
      else progressLabel.textContent = 'Ù…ÙƒØªÙ…Ù„! ğŸ‰';
      const circumference = 2 * Math.PI * 90;
      const offset = circumference * (1 - percent / 100);
      progressRing.style.strokeDashoffset = offset;
    }

    function resetProgress() {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…ØŸ')) {
        tasks.forEach(task => task.subtasks.forEach(st => st.completed = false));
        saveData();
        updateProgress();
        renderExecution();
      }
    }

    function goBack() {
      localStorage.setItem(phaseKey, 'setup');
      executionPhase.classList.remove('active');
      setupPhase.classList.add('active');
      renderSetup();
    }

    // Pomodoro Functions
    function updateDisplay() {
      const minutes = Math.floor(currentTime / 60);
      const seconds = currentTime % 60;
      timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      pomoStatus.textContent = isWork ? 'Ø¹Ù…Ù„' : 'Ø±Ø§Ø­Ø©';
      timerDisplay.style.color = isWork ? 'var(--success)' : 'var(--warning)';
    }

    function startTimer() {
      if (!isRunning) {
        isRunning = true;
        timerInterval = setInterval(() => {
          if (currentTime > 0) {
            currentTime--;
            updateDisplay();
          } else {
            clearInterval(timerInterval);
            isRunning = false;
            if (isWork) {
              alert('Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø§Ø­Ø©.');
              isWork = false;
              currentTime = breakTime;
            } else {
              alert('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø±Ø§Ø­Ø©! Ø§Ø¨Ø¯Ø£ Ø¬ÙˆÙ„Ø© Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯Ø©.');
              isWork = true;
              currentTime = workTime;
            }
            updateDisplay();
          }
        }, 1000);
      }
    }

    function pauseTimer() {
      if (isRunning) {
        clearInterval(timerInterval);
        isRunning = false;
      }
    }

    function resetTimer() {
      clearInterval(timerInterval);
      isRunning = false;
      isWork = true;
      currentTime = workTime;
      updateDisplay();
    }

    window.deleteTask = deleteTask;
    window.addSubtask = addSubtask;
    window.deleteSubtask = deleteSubtask;
    window.toggleSubtask = toggleSubtask;

    init();
  </script>
</body>
</html>
